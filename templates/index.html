<script>
    // ... 중략 (setMode, selectRow 등 동일) ...

    function draw(bleed, board, joint, spine) {
        const cvs = document.getElementById('mainCanvas'), ctx = cvs.getContext('2d');
        const h_input = parseFloat(document.getElementById('bookH').value) || 210; // 세로 값 가져오기
        
        ctx.clearRect(0, 0, cvs.width, cvs.height);
        
        const totalW = bleed*2 + board*2 + (joint*2) + spine;
        const scale = 700 / totalW;
        
        // 세로 높이 시각화 (기본 100px에서 세로 규격에 따라 비례 조절)
        const baseH = 120;
        const drawH = Math.min(baseH * (h_input / 210), 160); // 너무 커지지 않게 제한
        const y = (cvs.height - drawH) / 2 + 10;
        const x_start = 50;
        let x = x_start;

        const box = (w, label, color, isBleed = false) => {
            if (w <= 0 && label === "홈") return;
            
            // 박스 그리기
            ctx.fillStyle = color;
            // 여분(Bleed)은 상하로 더 튀어나온 느낌을 주기 위해 높이를 살짝 다르게 표현 가능
            const rectH = isBleed ? drawH + 10 : drawH;
            const rectY = isBleed ? y - 5 : y;
            
            ctx.fillRect(x, rectY, w * scale, rectH);
            ctx.strokeStyle = "#cbd5e1";
            ctx.strokeRect(x, rectY, w * scale, rectH);
            
            // 라벨 (위)
            ctx.fillStyle = "#64748b";
            ctx.font = "bold 9px Arial";
            ctx.fillText(label, x + 2, rectY - 12);
            
            // 수치 (가운데)
            ctx.fillStyle = "#334155";
            ctx.font = "bold 11px font-mono";
            ctx.fillText(Math.round(w), x + (w * scale / 2) - 8, rectY + rectH / 2 + 5);
            
            // 세로 수치 표시 (가장 오른쪽 여분 박스 옆에 표시)
            if (x + w * scale > 700 && !isBleed) {
                ctx.fillStyle = "#94a3b8";
                ctx.fillText(`H: ${h_input}`, x + w * scale + 10, y + drawH / 2);
            }

            x += w * scale;
        };

        // 도면 구성 순서
        box(bleed, "여분", "#fee2e2", true); 
        box(board, "보드", "#f1f5f9");
        if(joint) box(joint, "홈", "#f8fafc");
        box(spine, "세네카", "#ffffff");
        if(joint) box(joint, "홈", "#f8fafc");
        box(board, "보드", "#f1f5f9"); 
        box(bleed, "여분", "#fee2e2", true);
    }
</script>